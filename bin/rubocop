#!/bin/bash

set -e

ALLOWED_WARNINGS=50

bundle exec rubocop --format simple | tee rubocop.txt

warnings=`grep "offenses detected" rubocop.txt | cut -d " " -f4`

if [ $warnings -gt $ALLOWED_WARNINGS ]
then
  echo -e "\033[31mallowed warnings $ALLOWED_WARNINGS\033[0m"
  echo -e "\033[31mactual warnings $warnings\033[0m"
  echo -e "\033[31mToo many rubocop warnings\033[0m"
  echo -e "\033[31mTry running 'bin/check_rubocop_against_master'\033[0m"
  exit 1
else
  echo $warnings/$ALLOWED_WARNINGS is just barely acceptable ಠ_ಠ
  exit 0
fi

